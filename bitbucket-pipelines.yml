image: node:16.5.0
pages:
  stage: deploy
  cache:
    key:
      files:
        - package-lock.json
      prefix: npm
    paths:
      - node_modules/
  script:
    - npm install
    - npm run build
    - cp -a dist/. public/
  artifacts:
    paths:
      - public
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

image: node:lts

pipelines:
  pull-requests:
    feature/*:
      - step:
        script:
          - npm install
          - npm run build
  branches:
    master:
      - step:
          name: Build latest version
          caches:
            - node
          script:
            - npm install
            - npm run build
      - step:
          name: Deploy latest
          caches:
            - node
          script:
            - pipe: atlassian/sftp-deploy:0.5.11
              variables:
                USER: $PIPE_USER
                SERVER: $PIPE_SERVER
                REMOTE_PATH: '~'
                LOCAL_PATH: 'dist'
                PASSWORD: $PIPE_PASS

    feature/FTT1-59-*:
      - step:
          name: Test pipeline
          caches:
            - node
          script:
            - npm install
            - npm run build
      - step:
          name: Deploy latest
          caches:
            - node
          script:
            - pipe: atlassian/sftp-deploy:0.5.11
              variables:
                USER: $PIPE_USER
                SERVER: $PIPE_SERVER
                REMOTE_PATH: '~'
                LOCAL_PATH: 'dist'
                PASSWORD: $PIPE_PASS